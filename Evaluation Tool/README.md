# CONFETTY Evaluation Tool

This repository contains the evaluation tool for CONFETTY. All tests have been executed on **Windows 11** using **Ubuntu in WSL2**.

## Table of Contents
- [Overview](#overview)
- [Prerequisites](#prerequisites)
- [Initial Setup and Reset](#initial-setup-and-reset)
- [Ganache Workspace Setup](#ganache-workspace-setup)
- [IPFS and Smart Contracts Deployment](#ipfs-and-smart-contracts-deployment)
- [Python Tests](#python-tests)
- [Troubleshooting](#troubleshooting)

## Overview

The CONFETTY Evaluation Tool runs a series of tests that analyze gas costs and execution times for various process configurations. The tests include:
- **X-ray tests** for the number of writing participants, message size, and process size.
- **Synthesis tests** including parallel split, parallel split & join, exclusive split, and exclusive split & join.
- A test with three state-of-the-art processes.

## Prerequisites

- **Operating System:** Windows 11 with Ubuntu (WSL2)
- **Software & Tools:**
  - MongoDBCompass (for managing databases)
  - Ganache (for Ethereum simulation)
  - Docker
  - Python (executed via PowerShell)
  - Docker Image: `006be17f8d0c` (used for the MARTSIA container)

## Initial Setup and Reset

1. **Database Cleanup:**  
   Connect to MongoDBCompass and create a ChorChain database. If it exists, drop all the ChorChain databases.  
   **Note:** The `admin` database cannot be deleted.

2. **Start the Server:**  
   Launch the server instance.

3. **User Authentication:**  
   Sign up and log in to the website.

## Ganache Workspace Setup

1. **Create a New Workspace:**  
   Configure Ganache with the following options:
   - **Hostname (SERVER):** `0.0.0.0`
   - **Total accounts to generate (ACCOUNT & KEYS):** `20`
   - **Seed (ACCOUNTS & KEYS):** `control pulse code indoor off imitate uncover lesson fragile isolate fault blast`
   - **Gas limit (CHAIN):** `35700000`
   - **Output logs to file (ADVANCED):** Select the `Ganache_Temp_Logs` folder inside the `\CONFETTY\Evaluation Tool` directory.

   **Info:**  
   - The **first** generated address is the default (ChorChain) and serves as the Attribute Certifier.
   - The **second**, **third**, **fourth**, and **fifth** addresses are used as Authorities.

## IPFS and Smart Contracts Deployment

Open **two Ubuntu WSL2 consoles** to execute the following steps:

### 1. Start IPFS

In the first console, run the following command.  
**Note:** Update the `/mnt` path with the absolute path to your CONFETTY folder.

```bash
sudo chmod 666 /var/run/docker.sock && \
docker ps -aq | xargs docker rm -f && \
docker run -it --name martsia_ethereum_container --network host -v \
/mnt/c/Users/X/Desktop/CONFETTY-main/Confidentiality\ Manager:/MARTSIA-KoB-API 006be17f8d0c \
bash -c "python3 -m pip install flask && \
python3 -m pip install Flask_cors && \
cd /MARTSIA-KoB-API/sh_files && \
sh db_and_IPFS.sh; exec bash"
```

> **Important:** Leave this console open and idle; do not close it.

### 2. Deploy the Smart Contracts

In the second console, execute:

```bash
docker exec -it martsia_ethereum_container bash -c "cd /MARTSIA-KoB-API/sh_files && sh deployment.sh; exec bash"
```

## Python Tests

The Python tests are executed from PowerShell. Inside the `\CONFETTY\Evaluation Tool` folder, the `test_Auto.py` script will:
- Generate the required JSON test inputs.
- Start the confidentiality API.
- Execute each test case 5 times.
- Create two Excel files in the `table_Output` folder:
  - `costs.xlsx` for gas cost measurements.
  - `timings.xlsx` for execution time measurements.

### Test Cases

1. **Number of Writing Participants X-ray Test (2 to 10 participants):**

   ```bash
   python test_Auto.py -t1
   ```

2. **Message Size Dimension X-ray Test (x1 to x9):**

   ```bash
   python test_Auto.py -t2
   ```

3. **Process Size Dimension X-ray Test (x1 to x10):**

   ```bash
   python test_Auto.py -t3
   ```

4. **Parallel Split Synth Test (x1 to x10):**

   ```bash
   python test_Auto.py -t4
   ```

5. **Parallel Split and Join Synth Test (x1 to x10):**

   ```bash
   python test_Auto.py -t5
   ```

6. **Exclusive Split Synth Test (x1 to x10):**

   ```bash
   python test_Auto.py -t6
   ```

7. **Exclusive Split and Join Synth Test (x1 to x10):**

   ```bash
   python test_Auto.py -t7
   ```

8. **Three State-of-the-Art Processes Test:**

   ```bash
   python test_Auto.py -t8
   ```

9. **Default Execution:**

   Without any `-t` input, the script will execute 5 times the last process generated by `generateJSONs.js`:

   ```bash
   python test_Auto.py
   ```

10. **Execute All Tests Together:**

    Run the following command to execute all tests sequentially.  
    **Note:** This process will take approximately **3 hours**.

    ```bash
    python test_Auto.py; python test_Auto.py -t1; python test_Auto.py -t2; python test_Auto.py -t3; python test_Auto.py -t4; python test_Auto.py -t5; python test_Auto.py -t6; python test_Auto.py -t7; python test_Auto.py -t8
    ```

> **Note:** After executing the scripts, PowerShell may crash.

## Troubleshooting

- **Ganache Performance Issues:**  
  If you experience performance degradation in Ganache, ensure that logs are being directed to the specified file (`Ganache_Temp_Logs`).

- **Docker Container Issues:**  
  Verify that the volume mapping for the CONFETTY folder is correct in the Docker command.
